<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Query Test ESRI Leafletl</title>
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />

  <!-- Loading Leaflet library -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css"
    integrity="sha512-M2wvCLH6DSRazYeZRIm1JnYyh22purTM+FDB5CsyxtQJYeKq83arPe5wgbNmcFXGqiSH2XR8dT/fJISVA1r/zQ=="
    crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"
    integrity="sha512-lInM/apFSqyy1o6s89K4iQUKg6ppXEgsVxT35HbzUupEVRh2Eu9Wdl4tHj7dZO0s1uvplcYGmt3498TtHq+log=="
    crossorigin=""></script>

    <!-- Loading ESRI Leaflet -->
  <script src="https://unpkg.com/esri-leaflet@2.0.8/dist/esri-leaflet.js"></script>

  <!-- Loading stylesheets for this page -->
  <link rel="stylesheet" href="querytest.css">

</head>

<body>
  <div id="map"></div>

  <div id="query" class="leaflet-bar">
  <label>
    Filter by</br>Science Theme:
    <select id="Science_Themes">
      <!-- make sure to encase string values in single quotes for valid sql -->
      <option value='1=1'>Any</option>
      <option value="Science_Themes LIKE '%Climate impacts on Atlantic and Great Lakes coastal and nearshore environments%'">Climate impacts on Atlantic and Great Lakes coastal and nearshore environments</option>
      <option value="Science_Themes LIKE '%Climate impacts on freshwater resources and ecosystems%'">Climate impacts on freshwater resources and ecosystems</option>
      <option value="Science_Themes LIKE '%Climate impacts on land-use and land-cover change%'">Climate impacts on land-use and land-cover change</option>
      <option value="Science_Themes LIKE '%Climate projections and assessments%'">Climate projections and assessments</option>
      <option value="Science_Themes LIKE '%Ecological vulnerability and species response to climate variability and change%'">Ecological vulnerability and species response to climate variability and change</option>
      <option value="Science_Themes LIKE '%Impacts of climate variability and change on cultural resources%'">Impacts of climate variability and change on cultural resources</option>
      <!-- <option value="Science_Themes='Climate projections and assessments'">West</option> -->
    </select>
  </label>
  </div>

  <!-- Creating the map object / script -->

  <script>

    var map = L.map('map',{
      center: [42.389810, -72.524684],
      zoom: 5,
      // zoomControl: false,
    });

    var esriTopo = L.esri.basemapLayer('Topographic').addTo(map);
    var ProjectMap = L.esri.featureLayer ({
      url: 'https://services.arcgis.com/2gdL2gxYNFY2TOUb/arcgis/rest/services/NECSC_Test_Data/FeatureServer/1',
      //making the polygons invisible
      weight: 0,
      fillOpacity: 0.5,
    });

    var sciencetheme = document.getElementById('Science_Themes');

    sciencetheme.addEventListener('change', function(){
      var ProjectMapQuery = ProjectMap.query()
        .where(sciencetheme.value)
        .run(function(error, featureCollection){
          console.log(sciencetheme.value);
          console.log(featureCollection);
          map.addLayer(featureCollection);
        });
    });

  </script>

</body>

</html>
